<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Albert's Galaxy - Leave Your Mark!</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    
    <!-- Local Files -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Black Hole Shader Scripts -->
    <script id="2d-fragment-shader" type="x-shader/x-fragment">
        #ifdef GL_ES
        precision mediump float;
        #endif
        #define PI 3.14159265359
        uniform sampler2D u_image;
        varying vec2 v_texCoord;
        uniform vec2 u_resolution;
        uniform vec2 u_mouse;
        uniform float u_mass;
        uniform float u_time;
        uniform float u_clickedTime;
        vec2 rotate(vec2 mt, vec2 st, float angle){
        float cos = cos((angle + u_clickedTime) * PI);
        float sin = sin(angle * 0.0);
        float nx = (cos * (st.x - mt.x)) + (sin * (st.y - mt.y)) + mt.x;
        float ny = (cos * (st.y - mt.y)) - (sin * (st.x - mt.x)) + mt.y;
        return vec2(nx, ny);
        }
        void main() {
        // Convert screen coordinates to normalized coordinates (0-1)
        vec2 st = gl_FragCoord.xy / u_resolution.xy;
        // Convert mouse coordinates to normalized coordinates (0-1) with Y flipped for WebGL
        vec2 mt = vec2(u_mouse.x / u_resolution.x, 1.0 - (u_mouse.y / u_resolution.y));
        
        float dx = st.x - mt.x;
        float dy = st.y - mt.y;
        float dist = sqrt(dx * dx + dy * dy);
        float pull = u_mass / (dist * dist);
        vec3 color = vec3(0.0);
        vec2 r = rotate(mt,st,pull);
        vec4 imgcolor = texture2D(u_image, r);
        color = vec3(
        (imgcolor.x - (pull * 0.25)),
        (imgcolor.y - (pull * 0.25)),
        (imgcolor.z - (pull * 0.25))
        );
        gl_FragColor = vec4(color,1.);
        }
    </script>
    <script id="2d-vertex-shader" type="x-shader/x-vertex">
        attribute vec2 a_position;
        attribute vec2 a_texCoord;
        varying vec2 v_texCoord;
        void main() {
        gl_Position = vec4(a_position, 0, 1);
        v_texCoord = a_texCoord;
        }
    </script>

    <!-- Black hole background layer -->
    <canvas id="blackhole-canvas"></canvas>
    
    <div id="loading">üåü Loading galaxy...</div>
    
    <!-- Three.js star galaxy layer -->
    <div id="canvas-container"></div>
    
    <div id="ui-overlay">
        <div id="instructions">
            <h3>üåü Albert's Galaxy</h3>
            <p><strong>Controls:</strong></p>
            <p>‚Ä¢ Drag: Rotate view</p>
            <p>‚Ä¢ Scroll: Zoom in/out</p>
            <p>‚Ä¢ Click stars to focus</p>
            <p>‚Ä¢ Space: Reset to center</p>
            <p><br><em>Welcome to the galaxy! Your star will be saved forever.</em></p>
        </div>

        <div id="search-container">
            <input type="text" id="search-input" placeholder="Search stars by name...">
            <div id="search-results"></div>
        </div>

        <div id="star-counter">
            <h3>‚≠ê Galaxy Stats</h3>
            <p>Status: <span id="connection-status">üîÑ Connecting...</span></p>
            <p>Total Stars: <span id="star-count">0</span></p>
            <p>Unique Visitors: <span id="visitor-count">0</span></p>
        </div>

        <div id="star-details">
            <h3>üåü Star Details</h3>
            <div id="star-info-content">
                <p><em>Click on a star to see its details</em></p>
            </div>
        </div>
    </div>

    <!-- Welcome Modal -->
    <div id="welcome-modal" class="hidden">
        <div class="modal-content">
            <h2>üåü Welcome to the Albert Galaxy!</h2>
            <p>Leave your mark in the cosmos by creating your own star.</p>
            
            <input type="text" id="user-name" placeholder="Enter your name" maxlength="20">
            
            <div>
                <label for="star-color">Choose your star color:</label>
                <input type="color" id="star-color" value="#ffffff">
                <div id="color-preview" style="background-color: #ffffff;"></div>
            </div>
            
            <button id="create-star" onclick="createUserStar()">Create My Star ‚ú®</button>
        </div>
    </div>

    <!-- Main Script -->
    <script src="script.js"></script>
</body>
</html>